import"./modulepreload-polyfill-B5Qt9EMX.js";import{TIME_STEP as A,BASE_ENEMY_SPEED as B,BASE_ENEMY_COUNT as N,BASE_PATROLLER_COUNT as b,COLOR_BACKGROUND as g,COLOR_TRAIL as O,COLOR_CAPTURED as G,CELL_SIZE as n,COLOR_PLAYER_STROKE as T,COLOR_ENEMY_BOUNCER_FILL as U,COLOR_ENEMY_PATROLLER_STROKE as M}from"./constants-CBwMEIId.js";import{triggerNextLevelStart as w,getGameState as L,updateGame as V,initGame as Y,handlePlayerInput as W,CellState as p}from"./gameLogic-BUwW-t6N.js";document.addEventListener("DOMContentLoaded",()=>{const E=document.getElementById("gameCanvas");if(!E){console.error("Canvas element not found!");return}const t=E.getContext("2d");if(!t){console.error("Failed to get 2D context!");return}let C,R,c,a,f=0,r=null,m=0;const d=document.getElementById("nextLevelButton");function _(e){const l=document.getElementById("score"),o=document.getElementById("lives"),s=document.getElementById("captured"),i=document.getElementById("level"),y=document.getElementById("target-percentage");l&&(l.textContent=e.score),o&&(o.textContent=e.lives),s&&(s.textContent=e.capturedPercentage.toFixed(0)),i&&(i.textContent=e.level),y&&(y.textContent=e.targetPercentage)}function v(e){const l=L();if(l.levelComplete){console.log("Key pressed during level complete screen."),d.style.display="none",w(),r&&cancelAnimationFrame(r),f=performance.now(),m=0,r=requestAnimationFrame(u);return}l.gameOver||["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&(e.preventDefault(),W(e.key)),(e.key==="r"||e.key==="R")&&l.gameOver&&(console.log("Restarting game..."),x())}function I(e){t.fillStyle=g,t.fillRect(0,0,c,a);for(let l=0;l<R;l++)for(let o=0;o<C;o++){const s=e.grid[l][o];switch(s){case p.CAPTURED:t.fillStyle=G;break;case p.TRAIL:t.fillStyle=O;break;case p.UNCAPTURED:default:t.fillStyle=g;break}s!==p.UNCAPTURED&&t.fillRect(o*n,l*n,n,n)}}function P(e){t.strokeStyle=T;const l=2;t.lineWidth=l;const o=e.player.x*n,s=e.player.y*n;t.strokeRect(o+l/2,s+l/2,n-l,n-l),e.isDrawing&&(t.fillStyle=O,e.currentTrail.forEach(i=>{i.x===e.player.x&&i.y===e.player.y||t.fillRect(i.x*n,i.y*n,n,n)}))}function S(e){e.enemies.forEach(l=>{const o=l.x*n,s=l.y*n;if(l.type==="bouncer"){t.fillStyle=U;const i=n*.4,y=o+n/2,k=s+n/2;t.beginPath(),t.arc(y,k,i,0,Math.PI*2),t.fill()}else if(l.type==="patroller"){t.strokeStyle=M;const i=2;t.lineWidth=i,t.strokeRect(o+i/2,s+i/2,n-i,n-i)}})}function D(e){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,c,a),t.font='bold 48px "VT323", monospace',t.fillStyle=O,t.textAlign="center",t.fillText(`LEVEL ${e.level} COMPLETE!`,c/2,a/2-60),t.font='28px "VT323", monospace',t.fillStyle=T,t.fillText(`SCORE: ${e.score}`,c/2,a/2-10)}function F(){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,c,a),t.font='bold 72px "VT323", monospace',t.fillStyle="#FFFFFF",t.textAlign="center",t.fillText("GAME OVER",c/2,a/2-30),t.font='36px "VT323", monospace',t.fillText("Press R to Restart",c/2,a/2+30)}function h(e){I(e),!e.levelComplete&&!e.gameOver?(P(e),S(e)):e.levelComplete?D(e):e.gameOver&&F()}function u(e){const l=e-f;f=e;const o=L();if(o.gameRunning)for(m+=l;m>=A;)V(),m-=A;h(o),_(o),o.levelComplete?d.style.display="block":d.style.display="none",!o.gameOver&&!o.levelComplete?r=requestAnimationFrame(u):console.log("Game loop paused (Game Over or Level Complete).")}d.addEventListener("click",()=>{console.log("Next level button clicked"),d.style.display="none",w(),r&&cancelAnimationFrame(r),f=performance.now(),m=0,r=requestAnimationFrame(u)});function x(){r&&(cancelAnimationFrame(r),r=null),Y(1,{baseEnemyCount:N,basePatrollerCount:b,enemySpeed:B});const e=L();C=e.gridCols,R=e.gridRows,c=C*n,a=R*n,E.width=c,E.height=a,console.log(`Canvas initialized to ${c}x${a}`),document.removeEventListener("keydown",v),document.addEventListener("keydown",v),f=performance.now(),r=requestAnimationFrame(u),d.style.display="none"}x(),console.log("Classic Xonix 2D Initialized (DOM Ready)")});
